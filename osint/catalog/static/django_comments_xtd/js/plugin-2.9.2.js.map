{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"React\"","webpack:///external \"django\"","webpack:///external \"jQuery\"","webpack:///external \"ReactDOM\"","webpack:///./django_comments_xtd/static/django_comments_xtd/js/src/lib.js","webpack:///./django_comments_xtd/static/django_comments_xtd/js/src/commentform.jsx","webpack:///./django_comments_xtd/static/django_comments_xtd/js/src/comment.jsx","webpack:///./django_comments_xtd/static/django_comments_xtd/js/src/commentbox.jsx","webpack:///./django_comments_xtd/static/django_comments_xtd/js/src/index.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","React","django","jQuery","ReactDOM","jquery_ajax_setup","csrf_cookie_name","$","ajaxSetup","beforeSend","xhr","settings","method","type","test","this","crossDomain","setRequestHeader","cookieValue","document","cookie","cookies","split","trim","substring","decodeURIComponent","getCookie","CommentForm","props","state","email","url","comment","followup","default_followup","reply_to","visited","errors","previewing","alert","message","cssc","handle_input_change","handle_ajax_error","handle_blur","handle_submit","handle_preview","reset_form","fhelp","className","gettext","event","target","checked","iname","setState","field","is_authenticated","request_name","request_email_address","div_cssc","input_cssc","help","placeholder","required","id","maxLength","onChange","onBlur","label_cssc","htmlFor","help_cssc","helptext_style","helptext","fontSize","style","label","elem_id","status","css_class","202","204","403","on_comment_created","err","responseJSON","forEach","item","idx","array","handle_submit_response","console","error","toString","preventDefault","validate","form","honeypot","ajax","send_url","dataType","cache","success","textStatus","indexOf","preview_url","avatar_url","rawMarkup","Remarkable","render","__html","heading_name","avatar_img","src","height","width","href","current_user","header_text","header","nowtext","dangerouslySetInnerHTML","render_field_comment","render_field_name","mail","render_field_email","render_field_url","render_field_followup","btns_row_class","btn_submit_class","btn_preview_class","btn_label_preview","btn_label_send","onSubmit","defaultValue","content_type","object_pk","timestamp","security_hash","display","onClick","preview","render_preview","div_class","alert_div","render_form","Component","Comment","flags","like","active","users","dislike","removal","count","user","join","flag","reduce_flags","removal_count","like_users","dislike_users","reply_form","component","is_visible","action_like","action_dislike","handle_reply_click","username","user_name","moderator","user_url","is_removed","user_moderator","flagging_count","flagging_html","moderate_html","can_moderate","fmts","ngettext","text","interpolate","title","allow_flagging","inapp_msg","flag_url","replace","login_url","remove_msg","delete_url","dir","allow_feedback","attr_list","show_users_chunk","show_feedback","current_user_id","user_ids","map","pos","data-toggle","class_icon","click_hdl","opinion","who_can_post","feedback_id","disposeTooltips","like_feedback","_get_feedback_chunk","dislike_feedback","submit_status","location","reply_url","visible","make_form_invisible","level","max_thread_level","reply_label","extra_space","cls","feedback_url","statusCode","201","non_field_errors","_post_feedback","like_url","dislike_url","elem","parentElement","querySelector","getElementById","is_hover","tooltip","html","selector","comment_id","_get_username_chunk","right_div","_get_right_div_chunk","comment_body","render_comment_body","feedback_btns","reply_link","render_feedback_btns","_get_reply_link_chunk","render_reply_form","new_label","newcids","children","user_avatar","submit_date","permalink","CommentBox","lib","tree","cids","counter","comment_count","handle_comment_created","handle_update","load_comments","allow_comments","html_id_suffix","_id","undefined","innerHTML","diff","Array","order","comments","incids","curcids","get_children","cid","index","parent_id","list_url","create_tree","count_url","polling_interval","setInterval","load_count","comment_counter","render_comment_counter","update_alert","render_update_alert","comment_form","render_comment_form","nodes","createElement","assign","comments_props","comments_props_override"],"mappings":"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","file":"plugin-2.9.2.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([5,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = React;","module.exports = django;","module.exports = jQuery;","module.exports = ReactDOM;","import $ from 'jquery';\r\n\r\nexport function getCookie(name) {\r\n  var cookieValue = null;\r\n  if (document.cookie && document.cookie !== '') {\r\n    var cookies = document.cookie.split(';');\r\n    for (var i = 0; i < cookies.length; i++) {\r\n      var cookie = jQuery.trim(cookies[i]);\r\n      // Does this cookie string begin with the name we want?\r\n      if (cookie.substring(0, name.length + 1) === (name + '=')) {\r\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return cookieValue;\r\n}\r\n\r\nexport function csrfSafeMethod(method) {\r\n  // these HTTP methods do not require CSRF protection\r\n  return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));\r\n}\r\n\r\nexport function jquery_ajax_setup(csrf_cookie_name) {\r\n  $.ajaxSetup({\r\n    beforeSend: function(xhr, settings) {\r\n      if (!csrfSafeMethod(settings.type) && !this.crossDomain) {\r\n        xhr.setRequestHeader(\"X-CSRFToken\", getCookie(csrf_cookie_name));\r\n      }\r\n    }\r\n  });\r\n}\r\n","import $ from 'jquery';\r\nimport django from 'django';\r\n\r\nimport React from 'react';\r\nimport { Remarkable } from 'remarkable';\r\n\r\n\r\nexport class CommentForm extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      name: '', email: '', url: '', comment: '',\r\n      followup: props.default_followup,\r\n      reply_to: this.props.reply_to || 0,\r\n      visited: {name: false, email: false, comment: false},\r\n      errors: {name: false, email: false, comment: false},\r\n      previewing: false,\r\n      alert: {message: '', cssc: ''}\r\n    };\r\n    this.handle_input_change = this.handle_input_change.bind(this);\r\n    this.handle_ajax_error = this.handle_ajax_error.bind(this);\r\n    this.handle_blur = this.handle_blur.bind(this);\r\n    this.handle_submit = this.handle_submit.bind(this);\r\n    this.handle_preview = this.handle_preview.bind(this);\r\n    this.reset_form = this.reset_form.bind(this);\r\n    this.fhelp = <span className=\"form-text small invalid-feedback\">\r\n                   {django.gettext(\"This field is required.\")}\r\n                 </span>;\r\n  }\r\n\r\n  handle_input_change(event) {\r\n    const target = event.target;\r\n    const value = target.type === 'checkbox' ? target.checked : target.value;\r\n    const iname = target.name;\r\n\r\n    this.setState({[iname]: value});\r\n  }\r\n\r\n  handle_blur(field) {\r\n    function handler(event) {\r\n      var visited = this.state.visited;\r\n      visited[field] = true;\r\n      this.setState({visited: visited});\r\n    };\r\n    return handler.bind(this);\r\n  }\r\n\r\n  validate() {\r\n    var errors = this.state.errors;\r\n    errors.name = false;\r\n    errors.email = false;\r\n\r\n    if(!this.state.comment.length)\r\n      errors.comment = true;\r\n    else errors.comment = false;\r\n    if(!this.props.is_authenticated || this.props.request_name) {\r\n      if(/^\\s*$/.test(this.state.name))\r\n        errors.name = true;\r\n      else errors.name = false;\r\n    }\r\n    if(!this.props.is_authenticated || this.props.request_email_address) {\r\n      if(/\\S+@\\S+\\.\\S+/.test(this.state.email))\r\n        errors.email = false;\r\n      else errors.email = true;\r\n    }\r\n    this.setState({errors: errors});\r\n\r\n    if(this.state.errors.comment ||\r\n       this.state.errors.name ||\r\n       this.state.errors.email)\r\n      return false;\r\n    else return true;\r\n  }\r\n\r\n  render_field_comment() {\r\n    let div_cssc = \"form-group row\",\r\n        input_cssc = \"form-control\",\r\n        help = \"\";\r\n    if (this.state.reply_to > 0) {\r\n      input_cssc += \" form-control-sm\";\r\n    }\r\n    if (this.state.errors.comment) {\r\n      div_cssc += (this.state.errors.comment ? \" has-danger\" : \"\");\r\n      input_cssc += \" is-invalid\";\r\n      help = this.fhelp;\r\n    }\r\n    var placeholder = django.gettext(\"Your comment\");\r\n    return (\r\n      <div className={div_cssc}>\r\n        <div className=\"offset-md-1 col-md-10\">\r\n          <textarea required name=\"comment\" id=\"id_comment\"\r\n                    placeholder={placeholder} maxLength=\"3000\"\r\n                    className={input_cssc} value={this.state.comment}\r\n                    onChange={this.handle_input_change}\r\n                    onBlur={this.handle_blur('comment')} />\r\n          {help}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render_field_name() {\r\n    if(this.props.is_authenticated && !this.props.request_name)\r\n      return \"\";\r\n    let div_cssc = \"form-group row\",\r\n        label_cssc = \"col-form-label col-md-3 text-right\",\r\n        input_cssc = \"form-control\",\r\n        help = \"\";\r\n    const placeholder = django.gettext('name');\r\n    if (this.state.reply_to > 0) {\r\n      label_cssc += \" form-control-sm\";\r\n      input_cssc += \" form-control-sm\";\r\n    }\r\n    if (this.state.errors.name) {\r\n      div_cssc += \" has-danger\";\r\n      input_cssc += \" is-invalid\";\r\n      help = this.fhelp;\r\n    }\r\n    return (\r\n      <div className={div_cssc}>\r\n        <label htmlFor=\"id_name\" className={label_cssc}>\r\n          {django.gettext(\"Name\")}\r\n        </label>\r\n        <div className=\"col-md-7\">\r\n          <input type=\"text\" name=\"name\" required id=\"id_name\"\r\n                 value={this.state.name} placeholder={placeholder}\r\n                 onChange={this.handle_input_change}\r\n                 onBlur={this.handle_blur('name')}\r\n                 className={input_cssc} />\r\n          {help}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render_field_email() {\r\n    if(this.props.is_authenticated && !this.props.request_email_address)\r\n      return \"\";\r\n    let div_cssc = \"form-group row\",\r\n        label_cssc = \"col-form-label col-md-3 text-right\",\r\n        input_cssc = \"form-control\",\r\n        help_cssc = \"form-text small\",\r\n        helptext_style = {};\r\n    const placeholder = django.gettext('mail address'),\r\n          helptext = django.gettext('Required for comment verification.');\r\n    if (this.state.reply_to > 0) {\r\n      label_cssc += \" form-control-sm\";\r\n      input_cssc += \" form-control-sm\";\r\n      helptext_style = {fontSize: \"0.710rem\"};\r\n    }\r\n    if (this.state.errors.email) {\r\n      div_cssc += \" has-danger\";\r\n      input_cssc += \" is-invalid\";\r\n      help_cssc += \" invalid-feedback\";\r\n    }\r\n    return (\r\n      <div className={div_cssc}>\r\n        <label htmlFor=\"id_email\" className={label_cssc}>\r\n          {django.gettext(\"Mail\")}\r\n        </label>\r\n        <div className=\"col-md-7\">\r\n          <input type=\"text\" name=\"email\" required id=\"id_email\"\r\n                 value={this.state.email} placeholder={placeholder}\r\n                 onChange={this.handle_input_change}\r\n                 onBlur={this.handle_blur('email')}\r\n                 className={input_cssc} />\r\n          <span className={help_cssc}\r\n                style={helptext_style}>{helptext}</span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render_field_url() {\r\n    if(this.props.is_authenticated)\r\n      return \"\";\r\n    let label_cssc = \"col-form-label col-md-3 text-right\",\r\n        input_cssc = \"form-control\";\r\n    if(this.state.reply_to > 0) {\r\n      label_cssc += \" form-control-sm\";\r\n      input_cssc += \" form-control-sm\";\r\n    }\r\n    if(this.state.errors.url)\r\n    var placeholder = django.gettext(\"url your name links to (optional)\");\r\n    return (\r\n      <div className=\"form-group row\">\r\n        <label htmlFor=\"id_url\" className={label_cssc}>\r\n          {django.gettext(\"Link\")}\r\n        </label>\r\n        <div className=\"col-md-7\">\r\n          <input type=\"text\" name=\"url\" id=\"id_url\"\r\n                 value={this.state.url}\r\n                 placeholder={placeholder}\r\n                 onChange={this.handle_input_change}\r\n                 className={input_cssc} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render_field_followup() {\r\n    let label = django.gettext(\"Notify me about follow-up comments\"),\r\n        label_cssc = \"custom-control-label\",\r\n        elem_id = \"id_followup\";\r\n    if(this.state.reply_to > 0) {\r\n        label_cssc += \" small\";\r\n        elem_id += `_${this.state.reply_to}`;\r\n    }\r\n    return (\r\n      <div className=\"form-group row\">\r\n        <div className=\"offset-md-3 col-md-7\">\r\n          <div className=\"custom-control custom-checkbox\">\r\n            <input className=\"custom-control-input\" type=\"checkbox\"\r\n                   checked={this.state.followup}\r\n                   onChange={this.handle_input_change}\r\n                   name=\"followup\" id={elem_id} />\r\n            <label className={label_cssc} htmlFor={elem_id}>\r\n              &nbsp;{label}\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  reset_form() {\r\n    this.setState({\r\n      name: '', email: '', url: '', followup: false, comment: '',\r\n      visited: {name: false, email: false, comment: false},\r\n      errors: {name: false, email: false, comment: false}\r\n    });\r\n  }\r\n\r\n  handle_submit_response(status) {\r\n    let css_class = \"\";\r\n    const\r\n      msg_202 = django.gettext(\"Your comment will be reviewed. Thank your for your patience.\"),\r\n\t    msg_204 = django.gettext(\"Thank you, a comment confirmation request has been sent by mail.\"),\r\n\t    msg_403 = django.gettext(\"Sorry, your comment has been rejected.\");\r\n\r\n    const message = {\r\n      202: msg_202,\r\n\t\t  204: msg_204,\r\n\t\t  403: msg_403\r\n    };\r\n\t  const cssc = \"alert alert-\";\r\n\r\n    if(status == 403)\r\n      css_class = cssc + \"danger\";\r\n    else css_class = cssc + \"info\";\r\n\r\n    this.setState({alert: {message: message[status], cssc: css_class},\r\n                   previewing: false});\r\n    this.reset_form();\r\n    this.props.on_comment_created();\r\n  }\r\n\r\n  handle_ajax_error(xhr, status, err) {\r\n    if(xhr.status == 400) {\r\n      let errors = this.state.errors;\r\n      xhr.responseJSON.forEach(function(item, idx, array) {\r\n        errors[item] = true;\r\n      });\r\n      this.setState({errors: errors});\r\n    } else if (xhr.status == 403) {\r\n      this.handle_submit_response(xhr.status);\r\n    } else {\r\n      console.error(xhr, status, err.toString());\r\n    }\r\n  }\r\n\r\n  handle_submit(event) {\r\n    event.preventDefault();\r\n    if(!this.validate())\r\n      return;\r\n\r\n    const data = {\r\n      ...this.props.form,\r\n      honeypot: '',\r\n      comment: this.state.comment,\r\n      name: this.state.name,\r\n      email: this.state.email,\r\n      url: this.state.url,\r\n      followup: this.state.followup,\r\n      reply_to: this.state.reply_to\r\n    };\r\n\r\n    $.ajax({\r\n      method: 'POST',\r\n      url: this.props.send_url,\r\n      data: data,\r\n      dataType: 'json',\r\n      cache: false,\r\n      success: function(data, textStatus, xhr) {\r\n        if([201, 202, 204].indexOf(xhr.status) > -1) {\r\n\t      this.handle_submit_response(xhr.status);\r\n        }\r\n      }.bind(this),\r\n      error: this.handle_ajax_error\r\n    });\r\n  }\r\n\r\n  handle_preview(event) {\r\n    event.preventDefault();\r\n    if(!this.validate())\r\n      return;\r\n\r\n    $.ajax({\r\n      method: 'POST',\r\n      url: this.props.preview_url,\r\n      data: { email: this.state.email },\r\n      dataType: 'json',\r\n      success: function(data, textStatus, xhr) {\r\n        if (xhr.status === 200)\r\n          this.setState({\r\n            avatar_url: data.url,\r\n            previewing: true\r\n          });\r\n      }.bind(this),\r\n      error: this.handle_ajax_error\r\n    });\r\n  }\r\n\r\n  rawMarkup() {\r\n    var md = new Remarkable();\r\n    const rawMarkup = md.render(this.state.comment);\r\n    return { __html: rawMarkup };\r\n  }\r\n\r\n  render_preview() {\r\n    if(!this.state.previewing)\r\n      return \"\";\r\n    let heading_name = \"\";\r\n\r\n    // Build Gravatar.\r\n    const avatar_img = <img className=\"mr-3\" src={this.state.avatar_url}\r\n                            height=\"48\" width=\"48\"/>;\r\n\r\n    if(this.state.url) {\r\n      heading_name = (<a href={this.state.url} target=\"_new\">\r\n                      {this.state.name}</a>);\r\n    } else {\r\n      if(this.props.is_authenticated)\r\n        heading_name = this.props.current_user.split(\":\")[1];\r\n      else heading_name = this.state.name;\r\n    }\r\n\r\n    let label = \"\";\r\n    var header_text = django.gettext(\"Your comment in preview\");\r\n    let header = <h5 className=\"text-center\">{header_text}</h5>;\r\n    if(this.state.reply_to > 0) {\r\n      header = \"\";\r\n      label = <div className=\"badge badge-info\">preview</div>;\r\n    }\r\n    var nowtext = django.gettext(\"Now\");\r\n    return (\r\n      <div>\r\n        <hr/>\r\n        {header}\r\n        <div className=\"media\">\r\n          {avatar_img}\r\n          <div className=\"media-body\">\r\n            <div className=\"comment pb-3\">\r\n              <h6 className=\"mb-1 small\">\r\n                {nowtext}&nbsp;-&nbsp;{heading_name}&nbsp;&nbsp;{label}\r\n              </h6>\r\n              <div className=\"preview\"\r\n                   dangerouslySetInnerHTML={this.rawMarkup()} />\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render_form() {\r\n    let comment = this.render_field_comment();\r\n    let name = this.render_field_name();\r\n    let mail = this.render_field_email();\r\n    let url = this.render_field_url();\r\n    let followup = this.render_field_followup();\r\n    let btns_row_class = \"form-group row\";\r\n    let btn_submit_class = \"btn btn-primary\",\r\n        btn_preview_class = \"btn btn-secondary\";\r\n    if(this.state.reply_to != 0) {\r\n      btns_row_class += \" mb-0\";\r\n      btn_submit_class += \" btn-sm\";\r\n      btn_preview_class += \" btn-sm\";\r\n    }\r\n    var btn_label_preview = django.gettext(\"preview\");\r\n    var btn_label_send = django.gettext(\"send\");\r\n\r\n    return (\r\n      <form method=\"POST\" onSubmit={this.handle_submit}>\r\n        <input type=\"hidden\" name=\"content_type\"\r\n               defaultValue={this.props.form.content_type}/>\r\n        <input type=\"hidden\" name=\"object_pk\"\r\n               defaultValue={this.props.form.object_pk}/>\r\n        <input type=\"hidden\" name=\"timestamp\"\r\n               defaultValue={this.props.form.timestamp}/>\r\n        <input type=\"hidden\" name=\"security_hash\"\r\n               defaultValue={this.props.form.security_hash}/>\r\n        <input type=\"hidden\" name=\"reply_to\"\r\n               defaultValue={this.state.reply_to}/>\r\n        <fieldset>\r\n          <div style={{display:'none'}}>\r\n            <input type=\"text\" name=\"honeypot\" defaultValue=\"\"/>\r\n          </div>\r\n          {comment} {name} {mail} {url} {followup}\r\n        </fieldset>\r\n\r\n        <div className={btns_row_class}>\r\n          <div className=\"offset-md-3 col-md-7\">\r\n            <button type=\"submit\" name=\"post\"\r\n                    className={btn_submit_class}>{btn_label_send}</button>&nbsp;\r\n            <button name=\"preview\" className={btn_preview_class}\r\n                   onClick={this.handle_preview}>{btn_label_preview}</button>\r\n          </div>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    let preview = this.render_preview();\r\n    let header = \"\";\r\n    let div_class = \"card card-block mt-2\";\r\n    var label = django.gettext(\"Post your comment\");\r\n    if(this.state.reply_to == 0) {\r\n      header = <h4 className=\"card-title text-center pb-3\">{label}</h4>;\r\n      div_class = \"card card-block mt-4 mb-5\";\r\n    }\r\n    let alert_div = \"\";\r\n    if(this.state.alert.message) {\r\n      alert_div = (\r\n        <div className={this.state.alert.cssc}>\r\n          {this.state.alert.message}\r\n        </div>\r\n      );\r\n    }\r\n    let form = this.render_form();\r\n\r\n    return (<div>\r\n              {preview}\r\n              <div className={div_class}>\r\n                <div className=\"card-body\">\r\n                  {header}\r\n                  {alert_div}\r\n                  {form}\r\n                </div>\r\n              </div>\r\n            </div>);\r\n  }\r\n}\r\n","import $ from 'jquery';\r\nimport django from 'django';\r\n\r\nimport React from 'react';\r\nimport { Remarkable } from 'remarkable';\r\n\r\nimport { CommentForm } from './commentform.jsx';\r\n\r\n\r\nfunction reduce_flags(data, current_user) {\r\n  const flags = {\r\n    like: { active: false, users: [] },\r\n    dislike: { active: false, users: [] },\r\n    removal: { active: false, count: 0 }\r\n  }\r\n  for (const item of data) {\r\n    const user = [item.id, item.user].join(\":\");\r\n    const active = user === current_user ? true : false;\r\n    if (item.flag === \"like\") {\r\n      flags.like.users.push(user);\r\n      if (active)\r\n        flags.like.active = active;\r\n    } else if (item.flag === \"dislike\") {\r\n      flags.dislike.users.push(user);\r\n      if (active)\r\n        flags.dislike.active = active;\r\n    } else if (item.flag === \"removal\") {\r\n      flags.removal.count += 1;\r\n      if (active)\r\n        flags.removal.active = active;\r\n    }\r\n  }\r\n  return flags;\r\n}\r\n\r\n\r\nexport class Comment extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    const flags = reduce_flags(props.data.flags, props.settings.current_user);\r\n    this.state = {\r\n      current_user: props.settings.current_user,\r\n      removal: flags.removal.active,\r\n      removal_count: flags.removal.count,\r\n      like: flags.like.active,\r\n      like_users: flags.like.users || [],\r\n      dislike: flags.dislike.active,\r\n      dislike_users: flags.dislike.users || [],\r\n      reply_form: {\r\n        component: null,\r\n        is_visible: false\r\n      }\r\n    };\r\n    this.action_like = this.action_like.bind(this);\r\n    this.action_dislike = this.action_dislike.bind(this);\r\n    this.handle_reply_click = this.handle_reply_click.bind(this);\r\n  }\r\n\r\n  _get_username_chunk() {\r\n    let username = this.props.data.user_name, moderator = \"\";\r\n\r\n    if(this.props.data.user_url && !this.props.data.is_removed)\r\n      username = <a href={this.props.data.user_url}>{username}</a>;\r\n\r\n    if(this.props.data.user_moderator) {\r\n      var label = django.gettext(\"moderator\");\r\n      moderator = (\r\n        <span>&nbsp;\r\n        <span className=\"badge badge-secondary\">{label}</span>\r\n        </span>\r\n      );\r\n    }\r\n    return <span>{username}{moderator}</span>;\r\n  }\r\n\r\n  _get_right_div_chunk() {\r\n    let flagging_count = \"\",\r\n        flagging_html = \"\",\r\n        moderate_html = \"\",\r\n        url = \"\";\r\n\r\n    if(this.props.data.is_removed)\r\n      return \"\";\r\n\r\n    if(this.props.settings.is_authenticated &&\r\n       this.props.settings.can_moderate &&\r\n       this.state.removal_count > 0)\r\n      {\r\n        let fmts = django.ngettext(\r\n          \"%s user has flagged this comment as inappropriate.\",\r\n          \"%s users have flagged this comment as inappropriate.\",\r\n          this.state.removal_count);\r\n        let text = django.interpolate(fmts, [this.state.removal_count]);\r\n        flagging_count = (<span className=\"badge badge-danger\" title={text}>\r\n          {this.state.removal_count}</span>);\r\n      }\r\n\r\n    if (this.props.settings.allow_flagging)\r\n      {\r\n        let inapp_msg = \"\";\r\n        if(this.state.removal) {\r\n          inapp_msg = django.gettext(\"I flagged it as inappropriate\");\r\n          flagging_html = (\r\n            <span>\r\n              {flagging_count}\r\n              <i className=\"fas fa-flag text-danger\" title={inapp_msg}></i>\r\n            </span>\r\n          );\r\n        } else {\r\n          if (this.props.settings.is_authenticated) {\r\n            url = this.props.settings.flag_url.replace('0', this.props.data.id);\r\n          } else {\r\n            url = (this.props.settings.login_url + \"?next=\" +\r\n                   this.props.settings.flag_url.replace('0', this.props.data.id));\r\n          }\r\n          inapp_msg = django.gettext(\"flag comment as inappropriate\");\r\n          flagging_html = (\r\n            <a className=\"mutedlink\" href={url}>\r\n              <i className=\"fas fa-flag\" title={inapp_msg}></i></a>\r\n          );\r\n        }\r\n      }\r\n\r\n    if(this.props.settings.is_authenticated &&\r\n       this.props.settings.can_moderate)\r\n      {\r\n        let remove_msg = django.gettext(\"remove comment\");\r\n        url = this.props.settings.delete_url.replace('0', this.props.data.id);\r\n        moderate_html = (<a className=\"mutedlink\" href={url}>\r\n          <i className=\"fas fa-trash-alt\" title={remove_msg}></i>\r\n        </a>);\r\n      }\r\n\r\n    return (<div>{flagging_html} {moderate_html}</div>);\r\n  }\r\n\r\n  _get_feedback_chunk(dir) {\r\n    if(!this.props.settings.allow_feedback)\r\n      return \"\";\r\n    let attr_list = dir + \"_users\";  // Produce (dis)like_users\r\n    let show_users_chunk = \"\";\r\n\r\n    if(this.props.settings.show_feedback) {\r\n      /* Check whether the user is no longer liking/disliking the comment,\r\n       * and be sure the list of users who liked/disliked the comment\r\n       * is up-to-date likewise.\r\n       */\r\n      let current_user_id = this.state.current_user.split(\":\")[0];\r\n      let user_ids = this.state[attr_list].map(function(item) {\r\n        return item.split(\":\")[0];\r\n      });\r\n      if(this.state[dir] &&            // If user expressed opinion, and\r\n         (user_ids.indexOf(current_user_id) == -1)) // user not included.\r\n        {                                       // Append user to the list.\r\n          this.state[attr_list].push(this.state.current_user);\r\n        } else if(!this.state[dir] &&     // If user has no opinion, and\r\n                  (user_ids.indexOf(current_user_id) > -1)) // user included.\r\n          {                                   // Remove the user from the list.\r\n            var pos = user_ids.indexOf(current_user_id);\r\n            this.state[attr_list].splice(pos, 1);\r\n          }\r\n\r\n      if(this.state[attr_list].length) {\r\n        let users = this.state[attr_list].map(function(item) {\r\n          return item.split(\":\")[1];\r\n        });\r\n        users = users.join(\"<br/>\");\r\n        show_users_chunk = (\r\n          <span>&nbsp;<a className=\"badge badge-primary text-white cfb-counter\"\r\n                         data-toggle=\"tooltip\" title={users}>\r\n            {this.state[attr_list].length}\r\n          </a></span>\r\n        );\r\n      }\r\n    }\r\n\r\n    let css_class = this.state[dir] ? '' : 'mutedlink';\r\n    let icon = dir == 'like' ? 'thumbs-up' : 'thumbs-down';\r\n    let class_icon = \"fas fa-\"+icon;\r\n    let click_hdl = dir == 'like' ? this.action_like : this.action_dislike;\r\n    let opinion=\"\", link=\"#\";\r\n    if (dir == 'like')\r\n      opinion = django.gettext('I like it');\r\n    else opinion = django.gettext('I dislike it');\r\n\r\n    return (\r\n      <span>{show_users_chunk}&nbsp;<a href=\"#\" onClick={click_hdl}\r\n                                       className={css_class}>\r\n        <i className={class_icon} title={opinion}>\r\n        </i></a>&nbsp;</span>);\r\n  }\r\n\r\n  render_feedback_btns() {\r\n    const {\r\n      allow_feedback, who_can_post, is_authenticated\r\n    } = this.props.settings;\r\n\r\n    if (allow_feedback) {\r\n      let feedback_id = \"feedback-\"+this.props.data.id;\r\n      if(this.props.settings.show_feedback)\r\n        this.disposeTooltips(feedback_id);\r\n      let like_feedback = this._get_feedback_chunk(\"like\");\r\n      let dislike_feedback = this._get_feedback_chunk(\"dislike\");\r\n      return (<span id={feedback_id} className=\"small\">{like_feedback}\r\n                <span className=\"text-muted\">|</span>{dislike_feedback}</span>);\r\n    } else\r\n      return null;\r\n  }\r\n\r\n  make_form_invisible(submit_status) {\r\n    this.props.on_comment_created();\r\n  }\r\n\r\n  handle_reply_click(event) {\r\n    event.preventDefault();\r\n    const { is_authenticated, who_can_post } = this.props.settings;\r\n    if (who_can_post === 'users' && !is_authenticated) {\r\n      return window.location.href = (\r\n        this.props.settings.login_url + \"?next=\" +\r\n        this.props.settings.reply_url.replace('0', this.props.data.id)\r\n      );\r\n    }\r\n    let component = this.state.reply_form.component;\r\n    let visible = !this.state.reply_form.is_visible;\r\n    if(component == null)\r\n      component = (\r\n        <CommentForm {...this.props.settings}\r\n                     reply_to={this.props.data.id}\r\n                     on_comment_created={this.make_form_invisible.bind(this)} />\r\n      );\r\n    this.setState({reply_form: {component: component, is_visible: visible}});\r\n  }\r\n\r\n  _get_reply_link_chunk() {\r\n    const { level } = this.props.data;\r\n    const { max_thread_level } = this.props.settings;\r\n    if (level >= max_thread_level)\r\n      return null;\r\n\r\n    let url = this.props.settings.reply_url.replace('0', this.props.data.id),\r\n        reply_label = django.gettext(\"Reply\");\r\n\r\n    if(this.props.settings.allow_feedback) {\r\n      return (\r\n        <span>&nbsp;&nbsp;<span className=\"text-muted\">&bull;</span>&nbsp;&nbsp;\r\n          <a className=\"small mutedlink\" href={url}\r\n             onClick={this.handle_reply_click}>{reply_label}</a>\r\n        </span>\r\n      );\r\n    } else {\r\n      return (<a className=\"small mutedlink\" href={url}\r\n              onClick={this.handle_reply_click}>{reply_label}</a>);\r\n    }\r\n  }\r\n\r\n  rawMarkup() {\r\n    var md = new Remarkable();\r\n    const rawMarkup = md.render(this.props.data.comment);\r\n    return { __html: rawMarkup };\r\n  }\r\n\r\n  render_comment_body() {\r\n    const extra_space = (!this.props.settings.allow_feedback) ? \"pb-3\" : \"\";\r\n    if(this.props.data.is_removed) {\r\n      let cls = `text-muted ${extra_space}`;\r\n      return (\r\n        <p className={cls}><em>{this.props.data.comment}</em></p>\r\n      );\r\n    } else {\r\n      let cls = `content ${extra_space}`;\r\n      return (\r\n        <div className={cls} dangerouslySetInnerHTML={this.rawMarkup()}/>\r\n      );\r\n    }\r\n  }\r\n\r\n  render_reply_form() {\r\n    if(!this.state.reply_form.is_visible)\r\n      return \"\";\r\n    return (\r\n      <div>{this.state.reply_form.component}</div>\r\n    );\r\n  }\r\n\r\n  _post_feedback(flag) {\r\n    $.ajax({\r\n      method: 'POST',\r\n      url: this.props.settings.feedback_url,\r\n      data: {comment: this.props.data.id, flag: flag},\r\n      dataType: 'json',\r\n      cache: false,\r\n      statusCode: {\r\n        201: function() {\r\n          let state = {};\r\n          if(flag=='like')\r\n            this.setState({like: true, dislike: false});\r\n          else if(flag=='dislike')\r\n            this.setState({dislike: true, like: false});\r\n        }.bind(this),\r\n        204: function() {\r\n          if(flag=='like')\r\n            this.setState({like: false});\r\n          else if(flag=='dislike')\r\n            this.setState({dislike: false});\r\n        }.bind(this)\r\n      },\r\n      error: function(xhr, status, err) {\r\n        if(xhr.status==400 && xhr.responseJSON.non_field_errors.length)\r\n          alert(xhr.responseJSON.non_field_errors[0]);\r\n        else\r\n          console.error(this.props.settings.feedback_url, status,\r\n                        err.toString());\r\n      }.bind(this)\r\n    });\r\n  }\r\n\r\n  action_like(event) {\r\n    event.preventDefault();\r\n    if(this.props.settings.is_authenticated)\r\n      return this._post_feedback('like');\r\n    else\r\n      return window.location.href = (\r\n        this.props.settings.login_url + \"?next=\" +\r\n        this.props.settings.like_url.replace('0', this.props.data.id)\r\n      );\r\n  }\r\n\r\n  action_dislike(event) {\r\n    event.preventDefault();\r\n    if(this.props.settings.is_authenticated)\r\n      return this._post_feedback('dislike');\r\n    else\r\n      return window.location.href = (\r\n        this.props.settings.login_url + \"?next=\" +\r\n        this.props.settings.dislike_url.replace('0', this.props.data.id)\r\n      );\r\n  }\r\n\r\n  is_hover(elem) {\r\n    return (elem.parentElement.querySelector(':hover') === elem);\r\n  }\r\n\r\n  disposeTooltips(feedback_id) {\r\n    // console.log(\"feedback_id = \"+feedback_id);\r\n    var elem = document.getElementById(feedback_id);\r\n    var is_hover = elem && this.is_hover(elem);\r\n    if(elem && !is_hover) {\r\n      $('#'+feedback_id+' A[data-toggle=\"tooltip\"]').tooltip('dispose');\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    var feedback_id = \"feedback-\" + this.props.data.id;\r\n    var options = {html: true, selector: '.cfb-counter'};\r\n    $('#'+feedback_id).tooltip(options);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    var feedback_id = \"feedback-\" + this.props.data.id;\r\n    var options = {html: true, selector: '.cfb-counter'};\r\n    $('#'+feedback_id).tooltip(options);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    var feedback_id = \"feedback-\" + this.props.data.id;\r\n    var elem = document.getElementById(feedback_id);\r\n    var is_hover = elem && this.is_hover(elem);\r\n    if(elem && !is_hover) {\r\n      $('#'+feedback_id+' A[data-toggle=\"tooltip\"]').tooltip('dispose');\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let comment_id = \"c\" + this.props.data.id;\r\n    let user_name = this._get_username_chunk();  // Plain name or link.\r\n    let right_div = this._get_right_div_chunk();  // Flagging & moderation.\r\n    let comment_body = this.render_comment_body();\r\n    let feedback_btns = \"\",\r\n        reply_link = \"\",\r\n        reply_form = \"\";\r\n    if (!this.props.data.is_removed) {\r\n      feedback_btns = this.render_feedback_btns();\r\n      reply_link = this._get_reply_link_chunk();\r\n      reply_form = this.render_reply_form();\r\n    }\r\n\r\n    var new_label = \"\";\r\n    if (this.props.newcids.indexOf(this.props.data.id) > -1) {\r\n      new_label = (\r\n        <span>\r\n          <span className=\"badge badge-success\">new</span>&nbsp;-&nbsp;\r\n        </span>\r\n      );\r\n    }\r\n\r\n    var children = \"\";\r\n    var settings = this.props.settings;\r\n    if (this.props.data.children != null) {\r\n      children = this.props.data.children.map(function(item) {\r\n        return (\r\n          <Comment key={item.id}\r\n                   data={item}\r\n                   settings={settings}\r\n                   newcids={this.props.newcids}\r\n                   on_comment_created={this.props.on_comment_created} />\r\n        );\r\n      }.bind(this));\r\n    }\r\n\r\n    return (\r\n      <div className=\"media\" id={comment_id}>\r\n        <img src={this.props.data.user_avatar}\r\n             className=\"mr-3\" height=\"48\" width=\"48\" />\r\n        <div className=\"media-body\">\r\n          <div className=\"comment pb-3\">\r\n            <a name={comment_id}></a>\r\n            <h6 className=\"mb-1 small d-flex\">\r\n              <div className=\"mr-auto\">\r\n                {new_label}{this.props.data.submit_date}&nbsp;-&nbsp;{user_name}\r\n                &nbsp;&nbsp;\r\n                <a className=\"permalink\" href={this.props.data.permalink}>¶</a>\r\n              </div>\r\n              {right_div}\r\n            </h6>\r\n            {comment_body}{feedback_btns}{reply_link}\r\n            {reply_form}\r\n          </div>\r\n          {children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import $ from 'jquery';\r\nimport React from 'react';\r\n\r\nimport * as lib from './lib.js';\r\nimport django from 'django';\r\n\r\nimport { Comment } from './comment.jsx';\r\nimport { CommentForm } from './commentform.jsx';\r\n\r\n\r\nexport class CommentBox extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    lib.jquery_ajax_setup('csrftoken');\r\n    this.state = {\r\n      previewing: false,\r\n      preview: {name: '', email: '', url: '', comment: ''},\r\n      tree: [], cids: [], newcids: [], counter: this.props.comment_count\r\n    };\r\n    this.handle_comment_created = this.handle_comment_created.bind(this);\r\n    this.handle_preview = this.handle_preview.bind(this);\r\n    this.handle_update = this.handle_update.bind(this);\r\n  }\r\n\r\n  handle_comment_created() {\r\n    this.load_comments();\r\n  }\r\n\r\n  handle_preview(name, email, url, comment) {\r\n    this.setState({\r\n      preview: {name: name, email: email, url: url, comment: comment},\r\n      previewing: true\r\n    });\r\n  }\r\n\r\n  handle_update(event) {\r\n    event.preventDefault();\r\n    this.load_comments();\r\n  }\r\n\r\n  reset_preview() {\r\n    this.setState({\r\n      preview: {name: '', email: '', url: '', comment: ''},\r\n      previewing: false\r\n    });\r\n  }\r\n\r\n  render_comment_counter() {\r\n    if (this.state.counter > 0) {\r\n      var fmts = django.ngettext(\"%s comment.\", \"%s comments.\",\r\n                                 this.state.cids.length);\r\n      var text = django.interpolate(fmts, [this.state.cids.length]);\r\n      return <h5 className=\"text-center\">{text}</h5>;\r\n    } else\r\n      return \"\";\r\n  }\r\n\r\n  render_comment_form() {\r\n    const {\r\n      allow_comments, who_can_post, is_authenticated, html_id_suffix\r\n    } = this.props;\r\n    if(allow_comments) {\r\n      if (\r\n        who_can_post === 'all' ||\r\n        (who_can_post === 'users' && is_authenticated)\r\n      ) {\r\n        return (\r\n          <CommentForm {...this.props}\r\n                       on_comment_created={this.handle_comment_created} />\r\n        );\r\n      } else {\r\n        const _id = `only-users-can-post-${html_id_suffix}`;\r\n        const elem = document.getElementById(_id);\r\n        if (elem != undefined)\r\n          return <div dangerouslySetInnerHTML={{__html: elem.innerHTML}} />;\r\n        else\r\n          return (\r\n            <h5 className=\"mt-4 mb-5 text-center text-info\">\r\n              {django.gettext(\"Only registered users can post comments.\")}\r\n           </h5>\r\n          );\r\n      }\r\n    } else {\r\n      return (\r\n        <h4 className=\"mt-4 mb-5 text-center text-secondary\">\r\n          {django.gettext(\"Comments are disabled for this article.\")}\r\n        </h4>\r\n      );\r\n    }\r\n  }\r\n\r\n  render_update_alert() {\r\n    var diff = this.state.counter - this.state.cids.length;\r\n    if (diff > 0) {\r\n      var fmts = django.ngettext(\"There is %s new comment.\",\r\n                                 \"There are %s new comments.\", diff);\r\n      var message = django.interpolate(fmts, [diff]);\r\n      return (\r\n        <div className=\"alert alert-info d-flex align-items-center\">\r\n          <p className=\"mr-auto\">{message}</p>\r\n          <button type=\"button\" className=\"btn btn-secondary btn-xs\"\r\n                  onClick={this.handle_update}>update</button>\r\n        </div>\r\n      );\r\n    } else\r\n      return \"\";\r\n  }\r\n\r\n  create_tree(data) {\r\n    var tree = new Array();\r\n    var order = new Array();\r\n    var comments = {};\r\n    var children = {};\r\n    var incids = [], curcids = [], newcids = [];\r\n\r\n    function get_children(cid) {\r\n      return children[cid].map(function(index) {\r\n        if(comments[index].children == undefined) {\r\n          comments[index].children = get_children(index);\r\n        }\r\n        return comments[index];\r\n      });\r\n    };\r\n\r\n    for (let item of data) {\r\n      incids.push(item.id);\r\n      comments[item.id] = item;\r\n      if (item.level == 0) {\r\n        order.push(item.id);\r\n      }\r\n      children[item.id] = [];\r\n      if (item.parent_id!==item.id) {\r\n        children[item.parent_id].push(item.id);\r\n      }\r\n    }\r\n    for (let id of order) {\r\n      comments[id].children = get_children(id);\r\n      tree.push(comments[id]);\r\n    }\r\n\r\n    // Update attributes curcids and newcids.\r\n    if (incids.length) {\r\n      if (this.state.cids.length) {\r\n        for (let id of incids) {\r\n          if (this.state.cids.indexOf(id) == -1)\r\n            newcids.push(id);\r\n          curcids.push(id);\r\n        }\r\n      } else {\r\n        curcids = incids;\r\n        newcids = [];\r\n      }\r\n    }\r\n\r\n    this.setState({tree: tree,\r\n                   cids: curcids,\r\n                   newcids: newcids,\r\n                   counter: curcids.length});\r\n  }\r\n\r\n  load_comments() {\r\n    $.ajax({\r\n      url: this.props.list_url,\r\n      dataType: 'json',\r\n      cache: false,\r\n      success: function(data) {\r\n        // Set here a cookie with the last time comments have been retrieved.\r\n        // I'll use it to add a label 'new' to every new comment received\r\n        // after the timestamp stored in the cookie.\r\n        this.create_tree(data);\r\n      }.bind(this),\r\n      error: function(xhr, status, err) {\r\n        console.error(this.props.list_url, status, err.toString());\r\n      }.bind(this)\r\n    });\r\n  }\r\n\r\n  load_count() {\r\n    $.ajax({\r\n      url: this.props.count_url,\r\n      dataType: 'json',\r\n      cache: false,\r\n      success: function(data) {\r\n        this.setState({counter: data.count});\r\n      }.bind(this),\r\n      error: function(xhr, status, err) {\r\n        console.error(this.props.count_url, status, err.toString());\r\n      }.bind(this)\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.load_comments();\r\n    if(this.props.polling_interval)\r\n      setInterval(this.load_count.bind(this), this.props.polling_interval);\r\n  }\r\n\r\n  render() {\r\n    var settings = this.props;\r\n    var comment_counter = this.render_comment_counter();\r\n    var update_alert = this.render_update_alert();\r\n    var comment_form = this.render_comment_form();\r\n\r\n    var nodes = this.state.tree.map(function(item) {\r\n      return (\r\n        <Comment key={item.id}\r\n                 data={item}\r\n                 settings={settings}\r\n                 newcids={this.state.newcids}\r\n                 on_comment_created={this.handle_comment_created} />\r\n      );\r\n    }.bind(this));\r\n\r\n    return (\r\n      <div>\r\n        {comment_counter}\r\n        {comment_form}\r\n        {update_alert}\r\n        <div className=\"comment-tree\">\r\n          <div className=\"media-list\">\r\n            {nodes}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nimport { CommentBox } from './commentbox.jsx';\r\n\r\n\r\nReactDOM.render(\r\n  React.createElement(CommentBox,\r\n                      Object.assign(window.comments_props,\r\n                                    window.comments_props_override)),\r\n  document.getElementById('comments')\r\n);\r\n"],"sourceRoot":""}